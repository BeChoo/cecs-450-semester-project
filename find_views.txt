#!/bin/bash
#Grep finds the view counts,
#sed formats it for awk,
#then awk sums them.

#Check for input file argument
if [ "$#" -eq 0 ];
then echo "Input file required";
else
#Grep finds all viewcounts in input file
grep -o "[0-9\.]*[0-9][kmbKMB] views" $1 |
#----------Big ugly sed block----------------------
#Change k/m/b into numbers and asterisk char
sed -E 's/[kK]/*1000/' |
sed -E 's/[mM]/*1000000/' |
sed -E 's/[bB]/*1000000000/' |
#Remove Excess text
sed -E 's/[a-zA-Z ]+//' |
#This basically multiplies floats by 10
#(But with text formatting)
sed -E 's/\.(.*)0/\1/'|
#This exchanges the asterisk char for a space
#(For awk's sake)
sed -E 's/([0-9]+)\*([0-9]+)/\1 \2/'|
#-------------------------------------------------
#Awk sums everything up and prints it into the file.
awk 'BEGIN {SUM=0} {SUM += $1 * $2} END {print SUM}'>results.txt;
fi
